<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="no-js">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="keywords" content="HaI,HaI丶Picture,Hai,Hal,个人相册,在线相册" />
        <meta name="description" content="HaI丶Picture是一个基于七牛云OSS搭建的个人相册，可在线预览多张图片" />
        <title>HaI丶Picture</title>
        <link rel="stylesheet" href="baguettebox.min.css"/>
        <link rel="stylesheet" href="style.css"/>
        <script src="jquery-3.1.1.min.js"></script>
        <script src="baguettebox.min.js"></script>
        <script src="modernizr.custom.js"></script>

    </head>
    <body>
        <div id="gallery" class="baguetteBoxOne gallery effect-1"> 
        </div>
        <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';">
        <p>Powered by Qiniu and Theme by Baguettebox & AnimOnScroll © 2019 HaI</p>
        </div>
        
        <script src="masonry.pkgd.min.js"></script> 
        <script src="imagesloaded.js"></script> 
        <script src="classie.js"></script> 
        <script src="AnimOnScroll.js"></script>
        <script type="text/javascript">
            //配置参数
            var appid = 'wxbb9a70d10651829b',
                appsercet = 'f6c32350257a1fdcb4eccaf33ff22cb4',
                mobile = '15736736889',
                timestamp=Math.round(new Date().getTime()/1000),
                nonce = MathRand(),
                bucket = 'yuhal-picture',
                authentication,
                accesstoken,
                uid,
                sign;

            //请求地址
            var sign_url = 'https://api.yuhal.com/v1/sign/index',
                token_url = 'https://api.yuhal.com/v1/token/token',
                authentication_url = 'https://api.yuhal.com/v1/authentication/index',
                bucket_url = 'https://api.yuhal.com/qiniu/bucket/'+bucket;

            $(function(){   
                
                //获取签名
                $.ajax({
                    type: "GET",
                    url: sign_url,
                    dataType: "json",
                    data: {
                        appid:appid,
                        appsercet:appsercet,
                        mobile:mobile,
                        timestamp:timestamp,
                        nonce:nonce
                    },
                    async : false,
                    success: function(data){
                        // console.log(data);
                        if(data.code==200){
                            sign = data.data.info;
                        }else{
                            console.log('签名错误!');
                        }
                       
                    }
                });

                //获取token
                $.ajax({
                    type: "POST",
                    url: token_url,
                    dataType: "json",
                    data: {
                        appid:appid,
                        mobile:mobile,
                        timestamp:timestamp,
                        nonce:nonce,
                        sign:sign,
                    },
                    async : false,
                    success: function(data){
                        // console.log(data);
                        if(data.code==200){
                            accesstoken = data.data.access_token;
                            uid = data.data.client.uid;
                        }else{
                            console.log('token错误!');
                        }
                       
                    }
                });

                //获取authentication
                $.ajax({
                    type: "GET",
                    url: authentication_url,
                    dataType: "json",
                    data: {
                        appid:appid,
                        uid:uid,
                        accesstoken:accesstoken,
                    },
                    async : false,
                    success: function(data){
                        // console.log(data);
                        if(data.code==200){
                            authentication = data.data.authentication;
                        }else{
                            console.log('身份验证错误!');
                        }
                       
                    }
                });

                //获取仓库下的图片
                $.ajax({
                    type: "GET",
                    url: bucket_url,
                    dataType: "json",
                    data: {
                        marker:'',
                        prefix:bucket,
                        // limit:100,
                        authentication:authentication,
                    },
                    async : false,
                    success: function(data){
                        // console.log(data);
                        if(data.code==200){
                            var html = '';
                            if(data.data[0].items.length>0){
                                console.log(data.data[0].items);
                                $.each(data.data[0].items, function(i, info){
                                    var sort = i+1;
                                    info.key = 'https://picture.yuhal.com/'+info.key;
                                    html += '<li><a href="'+info.key+'" title="第'+sort+'张图片"><img src="'+info.key+'"></a></li>';
                                });  
                                $('.gallery').append(html);   
                                LazyLoading();  
                            }else{
                                html = '<center>暂无图片!</center>';
                                $('.gallery').html(html);
                            }  
                        }else{
                            console.log('存储仓库错误!');
                        }
                    }
                });
                
                baguetteBox.run('.baguetteBoxOne', {
                    animation: 'fadeIn',
                });
                
            })


        
            
            //滚动加载
            // var marker = '';//上次返回标记
            // var limit = 12;//每次加载个数
            // var i = 1; //设置当前页数，全局变量
            // var totalPage = 3; //设置总页数
            // $(function () {
            //     //根据页数读取数据
            //     function getData(pagenumber) {
            //         i++;//页码自动增加，保证下次调用时为新的一页。
            //         $.ajax({
            //             type: "GET",
            //             url: bucket_url,
            //             dataType: "json",
            //             data: {
            //                 marker:marker,
            //                 prefix:bucket,
            //                 limit:limit,
            //                 authentication:authentication,
            //             },
            //             async : false,
            //             success: function(data){
            //                 // console.log(data);
            //                 if(data.code==200){
            //                     insertDiv(data.data[0].items,pagenumber);

            //                     if(data.data[0].marker){
            //                         marker = data.data[0].marker
            //                     }

            //                 }else{
            //                     alert('bucket error!');
            //                 }
            //             }
            //         });
            //     }

            //     //初始化加载第一页数据
            //     getData(1);
            //     //生成数据html，append到div中
            //     function insertDiv(json,pagenumber) {
            //         var html = '';

            //         $.each(json, function(i, info){
            //             var sort = i+limit*(pagenumber-1)+1;
            //             console.log(sort)
            //             info.key = 'https://picture.yuhal.com/'+info.key;
            //             html += '<li><a href="'+info.key+'" title="第'+sort+'张图片"><img src="'+info.key+'"></a></li>';
            //         });
            //         $('.gallery').append(html);   

            //         LazyLoading();
            //         baguetteBox.run('.baguetteBoxOne', {
            //             animation: 'fadeIn',
            //         });
                    

            //     }

            //     //==============核心代码=============
            //     var winH = $(window).height(); //页面可视区域高度 

            //     var scrollHandler = function () {
            //         var pageH = $(document.body).height();
            //         var scrollT = $(window).scrollTop(); //滚动条top 
            //         var aa = (pageH - winH - scrollT) / winH;
            //         if (aa < 0.02) {//0.02是个参数
            //             if (i % totalPage === 0) {//10页做一次停顿！
            //                 getData(i);
            //                 $(window).unbind('scroll');
            //                 // $("#btn_NextPage").show();
            //             } else {
            //                 getData(i);
            //                 // $("#btn_NextPage").hide();
            //             }

            //         }
            //     }
            //     //定义鼠标滚动事件
            //     $(window).scroll(scrollHandler);
            //     //==============核心代码=============

            // });

            //生成随机数
            function MathRand() 
            { 
                var Num=""; 
                for(var i=0;i<6;i++) 
                { 
                Num+=Math.floor(Math.random()*10); 
                } 
                return Num;
            }

            //懒加载
            function LazyLoading(){
                new AnimOnScroll(document.getElementById('gallery'), {
                    minDuration: 0.4,
                    maxDuration: 0.7,
                    viewportFactor: 0.2
                }); 
            }
           
        </script>
        
    </body>
</html>